<!DOCTYPE html>
<html>
<head>
  <style language='css'>
    body {
      font-family: sans-serif;
    }

    .hidden {
      display: none;
    }

    .abs {
      position: absolute;
    }
  </style>
</head>
<body>
  <svg class="abs" id="svg_define">
    <style type="text/css">
      #diagonalHatch {
        stroke-width: 1;
        stroke: white;
        /*fill: inherit;*/
      }

      mask {
        stroke-width: 1;
        stroke: white;
        /*fill: inherit;*/
      }
    </style>
    <defs>
      <pattern id="diagonalHatch" patternUnits="userSpaceOnUse" width="4" height="4">
        <path d="M-1,1 l 2,-2    M0,4 l 4,-4    M3,5 l 2,-2" />
      </pattern>

      <mask id="mask-circle-stripe">
        <circle cx="10" cy="10" r="8" fill="url(#diagonalHatch)" />
      </mask>
      <mask id="mask-circle-stripe-s">
        <circle cx="6" cy="6" r="4.8" fill="url(#diagonalHatch)" />
      </mask>

      <mask id="mask-triangle-stripe">
        <polygon points="10 2, 19 18, 1 18" fill="url(#diagonalHatch)" />
      </mask>
      <mask id="mask-triangle-stripe-s">
        <polygon points="6 1.2, 11.4 10.8, .6 10.8" fill="url(#diagonalHatch)" />
      </mask>

      <mask id="mask-square-stripe">
        <rect x="2" y="2" width="16" height="16" fill="url(#diagonalHatch)" />
      </mask>
      <mask id="mask-square-stripe-s">
        <rect x="1.2" y="1.2" width="9.6" height="9.6" fill="url(#diagonalHatch)" />
      </mask>
    </defs>



    <symbol id="circle-stripe" viewBox="0 0 20 20">
      <rect width="100%" height="100%" mask="url(#mask-circle-stripe)" />
    </symbol>
    <symbol id="circle-stripe-s" viewBox="0 0 12 12">
      <rect width="100%" height="100%" mask="url(#mask-circle-stripe-s)" />
    </symbol>

    <symbol id="circle-open" viewBox="0 0 20 20">
      <circle cx="10" cy="10" r="8" />
    </symbol>
    <symbol id="circle-open-s" viewBox="0 0 12 12">
      <circle cx="6" cy="6" r="4.8" />
    </symbol>

    <symbol id="square-open" viewBox="0 0 20 20">
      <rect x="2" y="2" width="16" height="16" />
    </symbol>
    <symbol id="square-open-s" viewBox="0 0 12 12">
      <rect x="1.2" y="1.2" width="9.6" height="9.6" />
    </symbol>

    <symbol id="triangle-open" viewBox="0 0 20 20">
      <polygon points="10 2, 19 18, 1 18" />
    </symbol>
    <symbol id="triangle-open-s" viewBox="0 0 12 12">
      <polygon points="6 1.2, 11.4 10.8, .6 10.8" />
    </symbol>

    <symbol id="card-circle-stripe-1" viewBox="0 0 1000 1500">
      <rect x="12" y="12" width="976" height="1476" fill="none" stroke-width="24" />
      <!--<path d="M500,0 l 0,1500" /> <path d="M0,750 l 1000,0" />-->
      <use href="#circle-stripe" x="250" y="500" width="500" height="500" />

      <use href="#circle-stripe-s" x="30" y="30" width="100" height="100" />

      <use href="#circle-stripe-s" x="870" y="1370" width="100" height="100" />
    </symbol>
    <symbol id="card-circle-stripe-2" viewBox="0 0 1000 1500">
      <rect x="12" y="12" width="976" height="1476" fill="none" stroke-width="24" />
      <!--<path d="M500,0 l 0,1500" /> <path d="M0,750 l 1000,0" />-->
      <use href="#circle-stripe" x="250" y="250" width="500" height="500" />
      <use href="#circle-stripe" x="250" y="750" width="500" height="500" />

      <use href="#circle-stripe-s" x="30" y="30" width="100" height="100" />
      <use href="#circle-stripe-s" x="30" y="130" width="100" height="100" />

      <use href="#circle-stripe-s" x="870" y="1270" width="100" height="100" />
      <use href="#circle-stripe-s" x="870" y="1370" width="100" height="100" />
    </symbol>
    <symbol id="card-circle-stripe-3" viewBox="0 0 1000 1500">
      <rect x="12" y="12" width="976" height="1476" fill="none" stroke-width="24" />
      <!--<path d="M500,0 l 0,1500" /> <path d="M0,750 l 1000,0" />-->
      <use href="#circle-stripe" x="250" y="500" width="500" height="500" />
      <use href="#circle-stripe" x="250" y="25" width="500" height="500" />
      <use href="#circle-stripe" x="250" y="975" width="500" height="500" />

      <use href="#circle-stripe-s" x="30" y="30" width="100" height="100" />
      <use href="#circle-stripe-s" x="30" y="130" width="100" height="100" />
      <use href="#circle-stripe-s" x="30" y="230" width="100" height="100" />

      <use href="#circle-stripe-s" x="870" y="1170" width="100" height="100" />
      <use href="#circle-stripe-s" x="870" y="1270" width="100" height="100" />
      <use href="#circle-stripe-s" x="870" y="1370" width="100" height="100" />
    </symbol>
  </svg>

  <div class='container'>
    <!--<svg height="300px" fill="none" stroke="firebrick">
      <use href="#card-square-open-3" />
    </svg>-->
  </div>


  <script src="jquery-3.5.1.min.js"></script>
  <script>
    $(document).ready(function () {
      ['circle', 'square', 'triangle'].forEach(e => {
        ['', '-s'].forEach(s => {
          if (e != 'circle') {
            let symbol_circle = $(`#circle-stripe${s}`);
            let symbol = symbol_circle.clone();
            symbol.attr('id', `${e}-stripe${s}`);
            let rect = symbol.find('rect');
            let mask = rect.attr('mask');
            rect.attr('mask', mask.replace('circle', e));
            symbol.insertBefore(symbol_circle);
          }
        });

        ['stripe', 'open'].forEach(fill => {
          if (e == 'circle' && fill == 'stripe') return;

          for (let i = 1; i <= 3; ++i) {
            let tri = $(`#card-circle-stripe-${i}`).clone();

            tri.attr("id", `card-${e}-${fill}-${i}`);
            tri.find('use').each(function () {
              let href = $(this).attr('href');
              $(this).attr('href', href.replace('circle-stripe', `${e}-${fill}`));
            });

            tri.appendTo($('#svg_define'));
          }
        });
      });

      generate_card();

      //create_card(2, 'orange', 'circle', 'stripe');

      shuffleArray(list_card);
      current_set = list_card.slice(0, 8);
      current_set.forEach(c => {
        create_card(c.number, CARD_COLOR[c.color], CARD_SHAPE[c.shape], CARD_FILL[c.fill]);
        console.log(`${c}`)
      });

      find_match(current_set);
    });

    function create_card(number, color, shape, fill) {
      let fill_color = fill == 'open' ? 'none' : color;
      if (fill == 'solid') fill = 'open';

      let card = $('<svg></svg>').attr({
        width: '250px',
        height: '300px',
        fill: fill_color,
        stroke: color
      }).append(`<use href="#card-${shape}-${fill}-${number}" />`);

      card.appendTo('.container');
      //refesh svg
      $(".container").html($(".container").html());
    }

    let combine = (list, n) =>
      n == 0 ?
        [[]] :
        list.flatMap((e, i) =>
          combine(
            list.slice(i + 1),
            n - 1
          ).map(c => [e].concat(c))
        );

    let list_card = [];
    let current_set;

    function generate_card() {
      let arr3 = [1, 2, 3];
      arr3.forEach(n =>
        arr3.forEach(c =>
          arr3.forEach(s =>
            arr3.forEach(f =>
              list_card.push(new Card(n, c, s, f))
            )
          )
        )
      );
      shuffleArray(list_card);
    }
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function test() {
      shuffleArray(list_card);
      let set8 = list_card.slice(0, 8);

      console.log("---- set 8 -----");
      set8.forEach(c => console.log(`${c}`));
      console.log("---- find match -----");

      find_match(set8);
    }
    function find_match(set_card) {
      let list_set = combine(set_card, 3);
      list_set.forEach(set => {
        let res = check_match(set);
        if (res.match) {
          console.log(res.case_match);
          console.log(set.join('\n'));
          console.log('==============');
        }
      });
      return null;
    }
    function check_match(set_card) {
      // case:
      // 1: 4 diff
      // 2: 3 diff
      // 3: 2 diff
      // 4: 1 diff
      let res_prop = [
        set_card.map(c => c.number).distinct().length
        , set_card.map(c => c.color).distinct().length
        , set_card.map(c => c.shape).distinct().length
        , set_card.map(c => c.fill).distinct().length
      ];
      //0 1 2 3 4
      //3,3,3,3
      //1,3,3,3  3,1,3,3  3,3,3,1
      //1,1,3,3  3,1,3,1  1,3,3,1
      //3,1,1,1  1,3,1,1  1,1,3,1
      let diff = res_prop.filter(r => r == 3).length;
      let same = res_prop.filter(r => r == 1).length;

      if ((diff == 4) ||
        (diff == 3 && same == 1) ||
        (diff == 2 && same == 2) ||
        (diff == 1 && same == 3)
      )
        return { match: true, case_match: same };

      return { match: false, case_match: 0 };
    }

    const distinct = (value, index, self) => self.indexOf(value) === index;

    Array.prototype.distinct = function () { return this.filter(distinct); }

    CARD_COLOR = [0, 'red', 'green', 'orange'];
    CARD_SHAPE = [0, 'circle', 'triangle', 'square'];
    CARD_FILL = [0, 'stripe', 'open', 'solid'];
    class Card {
      constructor(n, c, s, f) {
        [this.number, this.color, this.shape, this.fill] = [n, c, s, f];
      }

      toString() {
        return `${this.number} - ${CARD_COLOR[this.color]} - ${CARD_SHAPE[this.shape]} - ${CARD_FILL[this.fill]}`;
      }
    }
  </script>
</body>
</html>